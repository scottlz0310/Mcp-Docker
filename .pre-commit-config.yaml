---
# GitHub Actions Simulator - Pre-commit Configuration Template
# ç¾åœ¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ãæ®µéšçš„å“è³ªã‚²ãƒ¼ãƒˆè¨­å®š
#
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å“è³ªãƒ¬ãƒ™ãƒ«ã‚’æ®µéšçš„ã«é©ç”¨ã—ã¾ã™:
# 1. åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒã‚§ãƒƒã‚¯
# 2. Docker/Shell/YAML ã®é™çš„è§£æ
# 3. Python ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
# 4. GitHub Actions Simulator çµ±åˆãƒ†ã‚¹ãƒˆ
# 5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

# é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®èª¿æ•´ãŒå¯èƒ½ï¼‰
exclude: |
  (?x)^(
    \.git/.*|
    \.mypy_cache/.*|
    \.pytest_cache/.*|
    \.ruff_cache/.*|
    \.venv/.*|
    __pycache__/.*|
    node_modules/.*|
    output/.*|
    logs/.*|
    \.env.*|
    sbom-.*\.json|
    .*\.log
  )$

repos:
  # === Phase 1: åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒã‚§ãƒƒã‚¯ ===
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯
      - id: trailing-whitespace
        name: "ğŸ§¹ æœ«å°¾ç©ºç™½ã®å‰Šé™¤"
        description: "ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã®ä¸è¦ãªç©ºç™½ã‚’è‡ªå‹•å‰Šé™¤"
      - id: end-of-file-fixer
        name: "ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã®æ”¹è¡Œä¿®æ­£"
        description: "ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã«é©åˆ‡ãªæ”¹è¡Œã‚’è¿½åŠ "
      - id: check-yaml
        name: "ğŸ“‹ YAMLæ§‹æ–‡ãƒã‚§ãƒƒã‚¯"
        description: "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º"
        exclude: ^\.github/workflows/.*\.yml\.sample$
      - id: check-json
        name: "ğŸ“‹ JSONæ§‹æ–‡ãƒã‚§ãƒƒã‚¯"
        description: "JSON ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º"
      - id: check-toml
        name: "ğŸ“‹ TOMLæ§‹æ–‡ãƒã‚§ãƒƒã‚¯"
        description: "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º"
      - id: check-added-large-files
        name: "ğŸ“¦ å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯"
        description: "æ„å›³ã—ãªã„å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆã‚’é˜²æ­¢"
        args: ['--maxkb=1024']
      - id: check-merge-conflict
        name: "ğŸ”€ ãƒãƒ¼ã‚¸ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãƒã‚§ãƒƒã‚¯"
        description: "ãƒãƒ¼ã‚¸ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãƒãƒ¼ã‚«ãƒ¼ã®æ®‹å­˜ã‚’æ¤œå‡º"
      - id: check-executables-have-shebangs
        name: "ğŸ”§ å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®shebangãƒã‚§ãƒƒã‚¯"
        description: "å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã«é©åˆ‡ãªshebangãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª"
      - id: mixed-line-ending
        name: "ğŸ“„ æ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€"
        description: "æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’LFã«çµ±ä¸€"
        args: ['--fix=lf']

  # === Phase 2: Docker/Infrastructure å“è³ªãƒã‚§ãƒƒã‚¯ ===
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        name: "ğŸ³ Dockerfileå“è³ªãƒã‚§ãƒƒã‚¯"
        description: "Dockerfileã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ ã‚’ç¢ºèª"
        args: [
          --ignore, DL3008,  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šï¼ˆé–‹ç™ºç’°å¢ƒã§ã¯æŸ”è»Ÿæ€§ã‚’å„ªå…ˆï¼‰
          --ignore, DL3009,  # apt-get cleanï¼ˆãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã§å¯¾å¿œï¼‰
          --ignore, DL3018,  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šï¼ˆAlpineç”¨ï¼‰
          --ignore, DL3059,  # è¤‡æ•°RUNã‚³ãƒãƒ³ãƒ‰ï¼ˆå¯èª­æ€§ã‚’å„ªå…ˆï¼‰
        ]

  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.10.0
    hooks:
      - id: shellcheck
        name: "ğŸš Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯"
        description: "Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ½œåœ¨çš„ãªå•é¡Œã‚’æ¤œå‡º"
        args: [
          --severity=warning,
          --shell=bash,
          --exclude=SC2034,  # æœªä½¿ç”¨å¤‰æ•°ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§è¨±å¯ï¼‰
          --exclude=SC1091,  # å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆå‹•çš„ãƒ‘ã‚¹ã§è¨±å¯ï¼‰
        ]

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        name: "ğŸ“‹ YAMLå“è³ªãƒã‚§ãƒƒã‚¯"
        description: "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨æ§‹æ–‡ã‚’æ¤œè¨¼"
        args: [-c, .yamllint.yml]
        exclude: ^\.github/workflows/.*\.yml\.sample$

  # === Phase 3: Python ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ===
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        name: "ğŸ Python ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆRuffï¼‰"
        description: "Python ã‚³ãƒ¼ãƒ‰ã®å“è³ªã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é«˜é€Ÿãƒã‚§ãƒƒã‚¯"
        args: [--fix, --exit-non-zero-on-fix]
        files: ^(src/|tests/|examples/|scripts/.*\.py$)
      - id: ruff-format
        name: "ğŸ¨ Python ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆRuffï¼‰"
        description: "Python ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
        files: ^(src/|tests/|examples/|scripts/.*\.py$)

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: "ğŸ” Python å‹ãƒã‚§ãƒƒã‚¯ï¼ˆMyPyï¼‰"
        description: "Python ã‚³ãƒ¼ãƒ‰ã®å‹å®‰å…¨æ€§ã‚’æ¤œè¨¼"
        files: ^src/
        args: [--ignore-missing-imports, --strict-optional]
        additional_dependencies: [types-requests, types-PyYAML]

  # === Phase 4: GitHub Actions Simulator çµ±åˆãƒã‚§ãƒƒã‚¯ ===
  - repo: local
    hooks:
      # é«˜é€Ÿå˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆã‚³ãƒŸãƒƒãƒˆæ™‚ã«å¿…é ˆï¼‰
      - id: actions-simulator-unit-tests
        name: "ğŸ§ª Actions Simulator å˜ä½“ãƒ†ã‚¹ãƒˆ"
        description: "GitHub Actions Simulator ã®æ ¸å¿ƒæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ"
        entry: >
          uv run pytest
          tests/test_hangup_unit.py::TestDiagnosticServiceUnit::test_diagnostic_service_initialization
          tests/test_hangup_unit.py::TestProcessMonitorUnit::test_process_monitor_initialization
          tests/test_hangup_unit.py::TestExecutionTracerUnit::test_execution_tracer_initialization
          -x --tb=short --disable-warnings --timeout=30
        language: system
        pass_filenames: false
        files: ^(src/|tests/test_hangup_unit\.py)

      # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡æ¤œè¨¼
      - id: actions-workflow-validation
        name: "âœ… GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¤œè¨¼"
        description: "GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã¨è¨­å®šã‚’æ¤œè¨¼"
        entry: bash -c 'find .github/workflows -name "*.yml" -o -name "*.yaml" | grep -v "\.sample$" | head -5'
        language: system
        files: ^\.github/workflows/.*\.ya?ml$
        pass_filenames: false

      # Docker ç’°å¢ƒãƒã‚§ãƒƒã‚¯ï¼ˆè»½é‡ç‰ˆï¼‰
      - id: docker-environment-check
        name: "ğŸ³ Docker ç’°å¢ƒãƒã‚§ãƒƒã‚¯"
        description: "Docker ç’°å¢ƒã®åŸºæœ¬çš„ãªå‹•ä½œç¢ºèª"
        entry: bash -c 'docker --version && docker compose version && echo "âœ… Docker ç’°å¢ƒæ­£å¸¸"'
        language: system
        pass_filenames: false
        files: ^(Dockerfile|docker-compose\.ya?ml|\.dockerignore)$

      # Actions Simulator è¨­å®šæ¤œè¨¼
      - id: actions-simulator-config-check
        name: "âš™ï¸ Actions Simulator è¨­å®šæ¤œè¨¼"
        description: "Actions Simulator ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œè¨¼"
        entry: bash -c 'if [ -f ".env.example" ]; then echo "âœ… .env.example å­˜åœ¨ç¢ºèª"; else echo "âŒ .env.example ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; exit 1; fi'
        language: system
        files: ^(\.env\.example|pyproject\.toml|main\.py)$
        pass_filenames: false

  # === Phase 5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ ===
  - repo: local
    hooks:
      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯æ¤œè¨¼
      - id: documentation-link-check
        name: "ğŸ”— ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯æ¤œè¨¼"
        description: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª"
        entry: bash -c 'find . -name "*.md" -not -path "./.git/*" -not -path "./.venv/*" | head -5'
        language: system
        files: \.md$
        pass_filenames: false

      # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
      - id: version-consistency-check
        name: "ğŸ·ï¸ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯"
        description: "pyproject.toml ã¨ main.py ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ã‚’ç¢ºèª"
        entry: bash -c 'make version-sync && echo "âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ç¢ºèªå®Œäº†"'
        language: system
        files: ^(pyproject\.toml|main\.py)$
        pass_filenames: false

# === æ®µéšçš„å“è³ªã‚²ãƒ¼ãƒˆè¨­å®šã®èª¬æ˜ ===
#
# ã“ã®pre-commitè¨­å®šã¯ä»¥ä¸‹ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™:
#
# ğŸŸ¢ Level 1 - åŸºæœ¬å“è³ª (å¸¸æ™‚å®Ÿè¡Œ)
#   - ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
#   - åŸºæœ¬çš„ãªæ§‹æ–‡æ¤œè¨¼
#   - è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œã®è§£æ±º
#
# ğŸŸ¡ Level 2 - ã‚³ãƒ¼ãƒ‰å“è³ª (é–‹ç™ºæ™‚å®Ÿè¡Œ)
#   - é™çš„è§£æï¼ˆhadolint, shellcheck, yamllintï¼‰
#   - ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ï¼ˆruffï¼‰
#   - å‹å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆmypyï¼‰
#
# ğŸŸ  Level 3 - çµ±åˆå“è³ª (æ©Ÿèƒ½å¤‰æ›´æ™‚å®Ÿè¡Œ)
#   - å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
#   - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¤œè¨¼
#   - Dockerç’°å¢ƒãƒã‚§ãƒƒã‚¯
#
# ğŸ”´ Level 4 - é…å¸ƒå“è³ª (ãƒªãƒªãƒ¼ã‚¹å‰å®Ÿè¡Œ)
#   - åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
#   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§
#   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
#
# === ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³• ===
#
# 1. ç‰¹å®šã®ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–:
#    è©²å½“ã™ã‚‹hookã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã¾ãŸã¯å‰Šé™¤
#
# 2. é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ :
#    ä¸Šéƒ¨ã® exclude ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ 
#
# 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒã‚§ãƒƒã‚¯è¿½åŠ :
#    local repo ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ–°ã—ã„hookã‚’è¿½åŠ 
#
# 4. æ®µéšçš„å°å…¥:
#    æœ€åˆã¯ Level 1 ã®ã¿æœ‰åŠ¹åŒ–ã—ã€å¾ã€…ã«ä»–ã®ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ 
#
# === GitHub Actions Simulator ã¨ã®çµ±åˆä¾‹ ===
#
# ã“ã®pre-commitè¨­å®šã¯ä»¥ä¸‹ã®æ–¹æ³•ã§GitHub Actions Simulatorã¨çµ±åˆã•ã‚Œã¾ã™:
#
# 1. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¤œè¨¼:
#    - ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ã‚’ãƒã‚§ãƒƒã‚¯
#    - Actions Simulator ã§ã®å®Ÿè¡Œå¯èƒ½æ€§ã‚’äº‹å‰ç¢ºèª
#
# 2. Dockerç’°å¢ƒæ•´åˆæ€§:
#    - Dockerfileã®å“è³ªãƒã‚§ãƒƒã‚¯
#    - docker-compose.yml ã®æ§‹æ–‡æ¤œè¨¼
#    - Actions Simulator ã‚³ãƒ³ãƒ†ãƒŠã¨ã®äº’æ›æ€§ç¢ºèª
#
# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼:
#    - .env.example ã®å­˜åœ¨ç¢ºèª
#    - pyproject.toml ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
#    - ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®åŒæœŸç¢ºèª
#
# 4. ãƒ†ã‚¹ãƒˆçµ±åˆ:
#    - Actions Simulator ã®æ ¸å¿ƒæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
#    - ãƒãƒ³ã‚°ã‚¢ãƒƒãƒ—æ¤œå‡ºæ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
#    - è¨ºæ–­ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
#
# === ä½¿ç”¨æ–¹æ³• ===
#
# 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—:
#    pre-commit install
#
# 2. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®å®Ÿè¡Œ:
#    pre-commit run --all-files
#
# 3. ç‰¹å®šã®hookã®ã¿å®Ÿè¡Œ:
#    pre-commit run <hook-id>
#
# 4. Make ã‚³ãƒãƒ³ãƒ‰ã§ã®å®Ÿè¡Œ:
#    make pre-commit
#
# === ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ===
#
# 1. Dockeré–¢é€£ã‚¨ãƒ©ãƒ¼:
#    - Docker DesktopãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
#    - `make docker-health` ã§Dockerç’°å¢ƒã‚’ãƒã‚§ãƒƒã‚¯
#
# 2. Pythonç’°å¢ƒã‚¨ãƒ©ãƒ¼:
#    - `uv sync` ã§ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°
#    - ä»®æƒ³ç’°å¢ƒãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
#
# 3. ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ:
#    - ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèª
#    - `make test-hangup-quick` ã§è»½é‡ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
#
# 4. æ¨©é™ã‚¨ãƒ©ãƒ¼:
#    - `./scripts/fix-permissions.sh` ã‚’å®Ÿè¡Œ
#    - Docker rootless ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®šã‚’ç¢ºèª
