# E2Eテスト（End-to-End Tests）

## 目的

このディレクトリには、**実際のユーザーシナリオに基づいた完全なワークフローを検証するテスト**を配置します。

## 対象

- ユーザーが実際に行う操作の再現
- システム全体を通したデータフロー検証
- 実環境に近い条件でのテスト
- パフォーマンス・安定性検証

## テストファイル例

- `test_end_to_end_validation.py` - 包括的E2E検証
- `test_end_to_end_user_experience.py` - ユーザー体験E2E
- `test_hangup_end_to_end.py` - ハングアップシナリオE2E
- `test_hangup_scenarios.bats` - ハングアップシナリオ（bats版）
- `test_performance_stability_validation.py` - パフォーマンス安定性検証

## 実行方法

```bash
# E2Eテストのみ実行
make test-e2e

# または直接pytest
pytest tests/e2e/ -v --timeout=300

# Batsテスト
bats tests/e2e/*.bats
```

## ガイドライン

### ✅ E2Eテストに適している

- 実際のユーザーシナリオの再現
- 複数サービスを横断するワークフロー
- エラーハンドリング・リカバリの検証
- パフォーマンス・負荷テスト
- 長時間実行シナリオ

### ❌ E2Eテストに適していない

- 単一機能の検証 → `unit/`へ
- 単一サービスの統合テスト → `integration/`へ

## テスト作成のベストプラクティス

1. **現実的なシナリオ**: 実際のユーザー操作を模倣
2. **適切なタイムアウト**: 長時間テストには十分なタイムアウトを設定
3. **明確な検証**: 期待される最終状態を明確に
4. **データ準備**: 必要なテストデータを事前に準備
5. **エラー時のデバッグ情報**: ログ・スクリーンショット等を収集
6. **CI/CD最適化**: mainブランチ・リリース時のみ実行など条件付き実行を検討

## 実行時間について

E2Eテストは実行時間が長くなりがちです：

- **短いE2E**: 1-5分（通常実行）
- **長いE2E**: 5-30分（mainブランチのみ）
- **超長時間**: 30分以上（定期実行・リリース前のみ）

実行頻度と時間のバランスを考慮してテストを設計してください。

## CI/CDでの実行戦略

```yaml
# PR時: 短いE2Eのみ
- run: pytest tests/e2e/ -m "not slow" --timeout=300

# mainブランチ: すべてのE2E
- run: pytest tests/e2e/ --timeout=1800

# 定期実行: パフォーマンステスト含む
- run: pytest tests/e2e/ --timeout=3600
```
