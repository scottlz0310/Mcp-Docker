# =============================================================================
# Docker Compose Override Configuration Template
# GitHub Actions Simulator - ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šä¾‹
# =============================================================================
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ docker-compose.override.yml.sample ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
# å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯ docker-compose.override.yml ã«ã‚³ãƒ”ãƒ¼ã—ã¦è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ï¼š
#   cp docker-compose.override.yml.sample docker-compose.override.yml
#
# Docker Compose ã¯ä»¥ä¸‹ã®é †åºã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼š
# 1. docker-compose.yml (ãƒ™ãƒ¼ã‚¹è¨­å®š)
# 2. docker-compose.override.yml (ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š) â† ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
#
# æ³¨æ„: docker-compose.override.yml ã¯ç’°å¢ƒå›ºæœ‰ã®è¨­å®šã‚’å«ã‚€ãŸã‚ã€
#       å¿…è¦ã«å¿œã˜ã¦ .gitignore ã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
# =============================================================================

# Docker Compose Override Configuration
# Note: version field is no longer required in modern Docker Compose

services:
  # ==========================================================================
  # ğŸš€ Actions Simulator - é–‹ç™ºç’°å¢ƒæœ€é©åŒ–è¨­å®š
  # ==========================================================================
  # Note: actions-simulator service is defined with profiles in base config
  actions-simulator:
    # --- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– ---
    deploy:
      resources:
        limits:
          # é–‹ç™ºç’°å¢ƒã§ã®ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã‚’ç·©å’Œ
          memory: 8G        # ãƒ¡ãƒ¢ãƒªä¸Šé™ã‚’8GBã«å¢—åŠ ï¼ˆå¤§è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¯¾å¿œï¼‰
          cpus: "6.0"       # CPUä½¿ç”¨é‡ã‚’6ã‚³ã‚¢ã«å¢—åŠ 
        reservations:
          memory: 2G        # æœ€å°ãƒ¡ãƒ¢ãƒªäºˆç´„ã‚’2GBã«å¢—åŠ 
          cpus: "2.0"       # æœ€å°CPUäºˆç´„ã‚’2ã‚³ã‚¢ã«å¢—åŠ 

    # --- é–‹ç™ºç”¨ç’°å¢ƒå¤‰æ•°ã®è¿½åŠ ãƒ»ä¸Šæ›¸ã ---
    environment:
      # ãƒ‡ãƒãƒƒã‚°è¨­å®šã®å¼·åŒ–
      - ACTIONS_SIMULATOR_VERBOSE=true
      - ACTIONS_SIMULATOR_DEBUG=true
      - ACT_LOG_LEVEL=debug
      - ACTIONS_RUNNER_DEBUG=true
      - RUNNER_DEBUG=true

      # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
      - ACTIONS_SIMULATOR_ACT_TIMEOUT_SECONDS=1800  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’30åˆ†ã«å»¶é•·
      - ACT_PARALLEL_JOBS=4                         # ä¸¦åˆ—å®Ÿè¡Œã‚¸ãƒ§ãƒ–æ•°ã‚’å¢—åŠ 
      - DOCKER_BUILDKIT=1                           # BuildKitæœ‰åŠ¹åŒ–
      - COMPOSE_PARALLEL_LIMIT=8                    # Composeä¸¦åˆ—å‡¦ç†æ•°å¢—åŠ 

      # é–‹ç™ºè€…ä½“é¨“å‘ä¸Š
      - PYTHONUNBUFFERED=1                          # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°å‡ºåŠ›
      - PYTHONDONTWRITEBYTECODE=1                   # .pycãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆç„¡åŠ¹åŒ–
      - ACTIONS_SIMULATOR_HOT_RELOAD=true           # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
      - ACTIONS_SIMULATOR_AUTO_RESTART=true         # è‡ªå‹•å†èµ·å‹•æœ‰åŠ¹åŒ–

      # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
      - UV_CACHE_DIR=/app/.cache/uv
      - PIP_CACHE_DIR=/app/.cache/pip
      - ACT_CACHE_DIR=/opt/act/cache
      - DOCKER_BUILDKIT_CACHE_MOUNT_NS=github-actions-simulator

    # --- é–‹ç™ºç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã®è¿½åŠ  ---
    volumes:
      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
      - ./pyproject.toml:/app/pyproject.toml:ro     # ä¾å­˜é–¢ä¿‚è¨­å®š
      - ./uv.lock:/app/uv.lock:ro                   # ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«
      - ./.env:/app/.env:ro                         # ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«

      # é–‹ç™ºãƒ„ãƒ¼ãƒ«ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
      - ./tests:/app/tests:rw                       # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
      - ./docs:/app/docs:rw                         # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
      - ./scripts:/app/scripts:rw                   # ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

      # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®æœ€é©åŒ–
      - pip-cache:/app/.cache/pip:rw                # Pipã‚­ãƒ£ãƒƒã‚·ãƒ¥
      - pytest-cache:/app/.pytest_cache:rw          # Pytestã‚­ãƒ£ãƒƒã‚·ãƒ¥
      - mypy-cache:/app/.mypy_cache:rw              # Mypyã‚­ãƒ£ãƒƒã‚·ãƒ¥

      # é–‹ç™ºç”¨ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
      - ./tmp:/app/tmp:rw                           # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ç”¨
      - ./debug:/app/debug:rw                       # ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ç”¨

    # --- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã®è¿½åŠ  ---
    ports:
      - "8000:8000"     # HTTPã‚µãƒ¼ãƒãƒ¼
      - "8001:8001"     # ãƒ‡ãƒãƒƒã‚°ã‚µãƒ¼ãƒãƒ¼ï¼ˆè¿½åŠ ï¼‰
      - "5678:5678"     # Python ãƒ‡ãƒãƒƒã‚¬ãƒ¼ (debugpy)

    # --- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®èª¿æ•´ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰ ---
    cap_add:
      - SYS_PTRACE      # ãƒ‡ãƒãƒƒã‚¬ãƒ¼ä½¿ç”¨ã®ãŸã‚
      - NET_ADMIN       # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šå¤‰æ›´ã®ãŸã‚

    # --- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®èª¿æ•´ ---
    healthcheck:
      test: [
        "CMD",
        "bash",
        "-c",
        "curl -f http://localhost:8000/health || python -c 'import requests; requests.get(\"http://localhost:8000/health\")'"
      ]
      interval: 15s     # ãƒã‚§ãƒƒã‚¯é–“éš”ã‚’çŸ­ç¸®
      timeout: 10s      # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’çŸ­ç¸®
      retries: 5
      start_period: 60s # èµ·å‹•æ™‚é–“ã‚’å»¶é•·

    # --- ãƒ­ã‚°è¨­å®šã®æœ€é©åŒ– ---
    logging:
      driver: "json-file"
      options:
        max-size: "200m"    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å¢—åŠ 
        max-file: "10"      # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å¢—åŠ 
        labels: "service=actions-simulator,env=development"

  # ==========================================================================
  # ğŸš Actions Shell - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–é–‹ç™ºç’°å¢ƒ
  # ==========================================================================
  actions-shell:
    # --- é–‹ç™ºç”¨ãƒªã‚½ãƒ¼ã‚¹è¨­å®š ---
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: "4.0"
        reservations:
          memory: 1G
          cpus: "1.0"

    # --- é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ---
    environment:
      # é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š
      - SHELL=/bin/bash
      - TERM=xterm-256color
      - EDITOR=vim
      - PAGER=less

      # Gitè¨­å®šï¼ˆã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®Gitæ“ä½œç”¨ï¼‰
      - GIT_AUTHOR_NAME=${GIT_AUTHOR_NAME:-Developer}
      - GIT_AUTHOR_EMAIL=${GIT_AUTHOR_EMAIL:-dev@example.com}
      - GIT_COMMITTER_NAME=${GIT_COMMITTER_NAME:-Developer}
      - GIT_COMMITTER_EMAIL=${GIT_COMMITTER_EMAIL:-dev@example.com}

      # Pythoné–‹ç™ºç’°å¢ƒ
      - PYTHONPATH=/app:/app/src:/app/services
      - PYTEST_CURRENT_TEST=true

    # --- é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰ã®æ‹¡å¼µ ---
    command:
      - "bash"
      - "-c"
      - |
        echo 'ğŸš€ GitHub Actions Simulator - é–‹ç™ºã‚·ã‚§ãƒ«ç’°å¢ƒ'
        echo '=============================================='
        echo ''
        echo 'ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:'
        echo '  ğŸ­ Actions Simulator:'
        echo '    uv run python main.py actions --help'
        echo '    uv run python main.py actions list'
        echo '    uv run python main.py actions run <workflow>'
        echo ''
        echo '  ğŸ³ Docker & Act:'
        echo '    act --help'
        echo '    act --list'
        echo '    docker ps'
        echo '    docker images'
        echo ''
        echo '  ğŸ§ª ãƒ†ã‚¹ãƒˆ & å“è³ª:'
        echo '    uv run pytest'
        echo '    uv run pytest --cov'
        echo '    uv run mypy .'
        echo '    uv run ruff check .'
        echo ''
        echo '  ğŸ“Š ç›£è¦– & ãƒ‡ãƒãƒƒã‚°:'
        echo '    htop              # ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–'
        echo '    docker stats      # ã‚³ãƒ³ãƒ†ãƒŠãƒªã‚½ãƒ¼ã‚¹ç›£è¦–'
        echo '    tail -f /app/logs/*.log  # ãƒ­ã‚°ç›£è¦–'
        echo ''
        echo '  ğŸ”§ é–‹ç™ºãƒ„ãƒ¼ãƒ«:'
        echo '    uv add <package>  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ '
        echo '    uv sync           # ä¾å­˜é–¢ä¿‚åŒæœŸ'
        echo '    uv run --help     # UVå®Ÿè¡Œãƒ˜ãƒ«ãƒ—'
        echo ''
        echo 'ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã‚¿ãƒ–è£œå®ŒãŒåˆ©ç”¨å¯èƒ½ã§ã™'
        echo 'ğŸ“ ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /app'
        echo ''
        exec bash

  # ==========================================================================
  # ğŸ“Š Actions Server - æœ¬ç•ªç’°å¢ƒè¨­å®šä¾‹
  # ==========================================================================
  actions-server:
    # --- æœ¬ç•ªç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ ---
    deploy:
      resources:
        limits:
          memory: 6G        # æœ¬ç•ªç’°å¢ƒã§ã®å®‰å®šã—ãŸãƒ¡ãƒ¢ãƒªåˆ¶é™
          cpus: "4.0"       # CPUä½¿ç”¨é‡åˆ¶é™
        reservations:
          memory: 2G        # æœ€å°ãƒ¡ãƒ¢ãƒªä¿è¨¼
          cpus: "1.0"       # æœ€å°CPUä¿è¨¼

      # --- æœ¬ç•ªç’°å¢ƒã§ã®é…ç½®åˆ¶ç´„ ---
      placement:
        constraints:
          - node.role == manager    # ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œ
        preferences:
          - spread: node.id         # ãƒãƒ¼ãƒ‰é–“ã§ã®åˆ†æ•£é…ç½®

    # --- æœ¬ç•ªç’°å¢ƒç”¨ç’°å¢ƒå¤‰æ•° ---
    environment:
      # ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®æœ€é©åŒ–
      - LOG_LEVEL=info
      - ACT_LOG_LEVEL=info
      - ACTIONS_RUNNER_DEBUG=false
      - RUNNER_DEBUG=false
      - ACTIONS_SIMULATOR_VERBOSE=false
      - ACTIONS_SIMULATOR_DEBUG=false

      # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
      - ACTIONS_SIMULATOR_ACT_TIMEOUT_SECONDS=900
      - ACT_PARALLEL_JOBS=2
      - ACTIONS_SIMULATOR_MAX_CONCURRENT_WORKFLOWS=5

      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
      - ACTIONS_SIMULATOR_SECURITY_MODE=strict
      - ACTIONS_SIMULATOR_AUDIT_LOG=true
      - MASK_SECRETS_IN_LOGS=true

      # ç›£è¦–è¨­å®š
      - MONITOR_MEMORY_USAGE=true
      - MONITOR_CPU_USAGE=true
      - PERFORMANCE_METRICS_INTERVAL=60
      - HEALTH_CHECK_INTERVAL=30

    # --- æœ¬ç•ªç’°å¢ƒã§ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ è¨­å®š ---
    volumes:
      # èª­ã¿å–ã‚Šå°‚ç”¨ãƒã‚¦ãƒ³ãƒˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼‰
      - ./.github:/app/.github:ro
      - ./pyproject.toml:/app/pyproject.toml:ro
      - ./uv.lock:/app/uv.lock:ro

      # ãƒ­ã‚°ã¨ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–
      - actions-logs:/app/logs:rw
      - actions-output:/app/output:rw
      - actions-metrics:/app/metrics:rw

    # --- æœ¬ç•ªç’°å¢ƒã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š ---
    networks:
      - mcp-network
      - monitoring-network    # ç›£è¦–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®æ¥ç¶š

    # --- æœ¬ç•ªç’°å¢ƒã§ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ---
    healthcheck:
      test: [
        "CMD",
        "bash",
        "-c",
        "curl -f http://localhost:8000/health && curl -f http://localhost:8000/metrics"
      ]
      interval: 30s
      timeout: 15s
      retries: 3
      start_period: 120s

    # --- æœ¬ç•ªç’°å¢ƒã§ã®å†èµ·å‹•ãƒãƒªã‚·ãƒ¼ ---
    restart: always

    # --- æœ¬ç•ªç’°å¢ƒã§ã®ãƒ­ã‚°è¨­å®š ---
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "5"
        labels: "service=actions-server,env=production"

  # ==========================================================================
  # ğŸ” ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  # ==========================================================================

  # Prometheus ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
  prometheus:
    image: prom/prometheus:latest
    container_name: mcp-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus:rw
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=200h'
      - '--web.enable-lifecycle'
    networks:
      - mcp-network
      - monitoring-network
    profiles:
      - monitoring
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: "1.0"
        reservations:
          memory: 512M
          cpus: "0.5"

  # Grafana ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  grafana:
    image: grafana/grafana:latest
    container_name: mcp-grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-data:/var/lib/grafana:rw
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro
      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources:ro
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD:-admin}
      - GF_USERS_ALLOW_SIGN_UP=false
      - GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource
    networks:
      - monitoring-network
    profiles:
      - monitoring
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "0.5"
        reservations:
          memory: 256M
          cpus: "0.25"

  # ==========================================================================
  # ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  # ==========================================================================

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒŠãƒ¼
  security-scanner:
    image: aquasec/trivy:latest
    container_name: mcp-security-scanner
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - trivy-cache:/root/.cache/trivy:rw
      - ./security-reports:/reports:rw
    command:
      - "sh"
      - "-c"
      - |
        echo "ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹..."
        trivy image --format json --output /reports/security-scan-$(date +%Y%m%d-%H%M%S).json mcp-actions-simulator:latest
        echo "âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†"
    networks:
      - mcp-network
    profiles:
      - security
    restart: "no"
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: "1.0"

# =============================================================================
# ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
# =============================================================================
networks:
  # ç›£è¦–ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
  monitoring-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
    labels:
      - "com.github-actions-simulator.network=monitoring"

  # å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šï¼ˆæ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
  # external-network:
  #   external: true
  #   name: existing-network-name

# =============================================================================
# ğŸ’¾ ãƒœãƒªãƒ¥ãƒ¼ãƒ è¨­å®š
# =============================================================================
volumes:
  # é–‹ç™ºç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒœãƒªãƒ¥ãƒ¼ãƒ 
  pip-cache:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=cache"

  pytest-cache:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=cache"

  mypy-cache:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=cache"

  # æœ¬ç•ªç”¨ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ 
  actions-logs:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}/data/logs
    labels:
      - "com.github-actions-simulator.volume=data"

  actions-output:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}/data/output
    labels:
      - "com.github-actions-simulator.volume=data"

  actions-metrics:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=metrics"

  # ç›£è¦–ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ 
  prometheus-data:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=monitoring"

  grafana-data:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=monitoring"

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ 
  trivy-cache:
    driver: local
    labels:
      - "com.github-actions-simulator.volume=security"

# =============================================================================
# ğŸ“‹ ä½¿ç”¨ä¾‹ã¨ã‚³ãƒãƒ³ãƒ‰
# =============================================================================
#
# === åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³• ===
#
# 1. ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼:
#    cp docker-compose.override.yml.sample docker-compose.override.yml
#
# 2. è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º:
#    vi docker-compose.override.yml
#
# 3. é–‹ç™ºç’°å¢ƒã§ã®èµ·å‹•:
#    docker-compose up -d actions-simulator actions-shell
#
# 4. æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•:
#    docker-compose up -d actions-server
#
# 5. ç›£è¦–ç’°å¢ƒã®èµ·å‹•:
#    docker-compose --profile monitoring up -d
#
# 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®å®Ÿè¡Œ:
#    docker-compose --profile security up security-scanner
#
# === ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã®èµ·å‹• ===
#
# é–‹ç™ºç’°å¢ƒ:
#   docker-compose --profile debug up -d
#
# æœ¬ç•ªç’°å¢ƒ:
#   docker-compose --profile production up -d
#
# ç›£è¦–ç’°å¢ƒ:
#   docker-compose --profile monitoring up -d
#
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç’°å¢ƒ:
#   docker-compose --profile security up -d
#
# === ãƒªã‚½ãƒ¼ã‚¹ç›£è¦– ===
#
# ã‚³ãƒ³ãƒ†ãƒŠãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡:
#   docker stats
#
# ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡:
#   docker system df
#
# ãƒ­ã‚°ã®ç¢ºèª:
#   docker-compose logs -f actions-simulator
#
# === ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ===
#
# è¨­å®šã®æ¤œè¨¼:
#   docker-compose config
#
# ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª:
#   docker-compose ps
#
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹:
#   docker inspect --format='{{.State.Health.Status}}' mcp-actions-simulator
#
# === ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒ’ãƒ³ãƒˆ ===
#
# 1. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–:
#    - ä¸è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢
#    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®æ´»ç”¨
#    - ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã®é©åˆ‡ãªè¨­å®š
#
# 2. CPUä½¿ç”¨é‡ã®æœ€é©åŒ–:
#    - ä¸¦åˆ—å‡¦ç†æ•°ã®èª¿æ•´
#    - CPUã‚¢ãƒ•ã‚£ãƒ‹ãƒ†ã‚£ã®è¨­å®š
#    - ãƒ—ãƒ­ã‚»ã‚¹å„ªå…ˆåº¦ã®èª¿æ•´
#
# 3. ãƒ‡ã‚£ã‚¹ã‚¯I/Oã®æœ€é©åŒ–:
#    - SSDã®ä½¿ç”¨
#    - ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã®æœ€é©åŒ–
#    - ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
#
# 4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æœ€é©åŒ–:
#    - å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä½¿ç”¨
#    - ä¸è¦ãªãƒãƒ¼ãƒˆå…¬é–‹ã®å‰Šé™¤
#    - DNSè¨­å®šã®æœ€é©åŒ–
#
# =============================================================================
