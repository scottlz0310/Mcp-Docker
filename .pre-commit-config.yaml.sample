---
# GitHub Actions Simulator - Pre-commit Configuration Sample
# ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªpre-commitè¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
#
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ .pre-commit-config.yaml ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„:
#   cp .pre-commit-config.yaml.sample .pre-commit-config.yaml
#
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦ä»¥ä¸‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™:
# - å“è³ªãƒ¬ãƒ™ãƒ«ã®é¸æŠï¼ˆåŸºæœ¬/æ¨™æº–/å³æ ¼ï¼‰
# - ç‰¹å®šã®ãƒã‚§ãƒƒã‚¯ã®æœ‰åŠ¹/ç„¡åŠ¹
# - é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®èª¿æ•´
# - GitHub Actions Simulatorçµ±åˆã®è¨­å®š

# === è¨­å®šãƒ¬ãƒ™ãƒ«é¸æŠ ===
# ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„:
# - basic: åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒã‚§ãƒƒã‚¯ã®ã¿
# - standard: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼ˆæ¨å¥¨ï¼‰
# - strict: å…¨ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼ˆCI/CDç’°å¢ƒå‘ã‘ï¼‰

# ç¾åœ¨ã®è¨­å®šãƒ¬ãƒ™ãƒ«: standard
CONFIG_LEVEL: &config_level "standard"

# === é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®èª¿æ•´ï¼‰ ===
exclude: |
  (?x)^(
    # æ¨™æº–é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³
    \.git/.*|
    \.mypy_cache/.*|
    \.pytest_cache/.*|
    \.ruff_cache/.*|
    \.venv/.*|
    __pycache__/.*|
    node_modules/.*|
    output/.*|
    logs/.*|
    \.env.*|
    sbom-.*\.json|
    .*\.log|
    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã“ã“ã«è¿½åŠ 
    # ä¾‹: vendor/.*|
    # ä¾‹: generated/.*|
  )$

repos:
  # === Level: basic - åŸºæœ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒã‚§ãƒƒã‚¯ ===
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: "ğŸ§¹ æœ«å°¾ç©ºç™½ã®å‰Šé™¤"
      - id: end-of-file-fixer
        name: "ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã®æ”¹è¡Œä¿®æ­£"
      - id: check-yaml
        name: "ğŸ“‹ YAMLæ§‹æ–‡ãƒã‚§ãƒƒã‚¯"
        exclude: ^\.github/workflows/.*\.yml\.sample$
      - id: check-json
        name: "ğŸ“‹ JSONæ§‹æ–‡ãƒã‚§ãƒƒã‚¯"
      - id: check-added-large-files
        name: "ğŸ“¦ å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯"
        args: ['--maxkb=1024']
      - id: check-merge-conflict
        name: "ğŸ”€ ãƒãƒ¼ã‚¸ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãƒã‚§ãƒƒã‚¯"
      - id: mixed-line-ending
        name: "ğŸ“„ æ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€"
        args: ['--fix=lf']

  # === Level: standard - ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ ===
  # ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ CONFIG_LEVEL ãŒ "standard" ã¾ãŸã¯ "strict" ã®å ´åˆã«æœ‰åŠ¹

  # Docker/Infrastructure å“è³ªãƒã‚§ãƒƒã‚¯
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        name: "ğŸ³ Dockerfileå“è³ªãƒã‚§ãƒƒã‚¯"
        # ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªç„¡è¦–ãƒ«ãƒ¼ãƒ«
        args: [
          --ignore, DL3008,  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š
          --ignore, DL3009,  # apt-get clean
          --ignore, DL3018,  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šï¼ˆAlpineï¼‰
          # è¿½åŠ ã®ç„¡è¦–ãƒ«ãƒ¼ãƒ«ã‚’ã“ã“ã«è¿½åŠ 
          # --ignore, DL3059,  # è¤‡æ•°RUNã‚³ãƒãƒ³ãƒ‰
        ]

  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.10.0
    hooks:
      - id: shellcheck
        name: "ğŸš Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯"
        args: [
          --severity=warning,
          --shell=bash,
          --exclude=SC2034,  # æœªä½¿ç”¨å¤‰æ•°
          --exclude=SC1091,  # å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
          # è¿½åŠ ã®é™¤å¤–ãƒ«ãƒ¼ãƒ«ã‚’ã“ã“ã«è¿½åŠ 
          # --exclude=SC2086,  # ã‚¯ã‚©ãƒ¼ãƒˆä¸è¶³
        ]

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        name: "ğŸ“‹ YAMLå“è³ªãƒã‚§ãƒƒã‚¯"
        args: [-c, .yamllint.yml]
        exclude: ^\.github/workflows/.*\.yml\.sample$

  # Python ã‚³ãƒ¼ãƒ‰å“è³ª
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.6.9
    hooks:
      - id: ruff
        name: "ğŸ Python ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯"
        args: [--fix, --exit-non-zero-on-fix]
        files: ^(src/|tests/|examples/|scripts/.*\.py$)
      - id: ruff-format
        name: "ğŸ¨ Python ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
        files: ^(src/|tests/|examples/|scripts/.*\.py$)

  # === Level: strict - å³æ ¼ãªå“è³ªãƒã‚§ãƒƒã‚¯ ===
  # ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ CONFIG_LEVEL ãŒ "strict" ã®å ´åˆã®ã¿æœ‰åŠ¹
  # æœ¬æ ¼çš„ãªé–‹ç™ºã‚„CI/CDç’°å¢ƒã§ä½¿ç”¨

  # å‹ãƒã‚§ãƒƒã‚¯ï¼ˆstrict ãƒ¬ãƒ™ãƒ«ã§ã®ã¿æœ‰åŠ¹åŒ–ï¼‰
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.8.0
  #   hooks:
  #     - id: mypy
  #       name: "ğŸ” Python å‹ãƒã‚§ãƒƒã‚¯"
  #       files: ^src/
  #       args: [--ignore-missing-imports, --strict-optional]
  #       additional_dependencies: [types-requests, types-PyYAML]

  # === GitHub Actions Simulator çµ±åˆãƒã‚§ãƒƒã‚¯ ===
  - repo: local
    hooks:
      # åŸºæœ¬çš„ãªçµ±åˆãƒã‚§ãƒƒã‚¯ï¼ˆå…¨ãƒ¬ãƒ™ãƒ«ã§æœ‰åŠ¹ï¼‰
      - id: actions-workflow-validation
        name: "âœ… GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¤œè¨¼"
        entry: bash -c 'find .github/workflows -name "*.yml" -o -name "*.yaml" | grep -v "\.sample$" | head -5'
        language: system
        files: ^\.github/workflows/.*\.ya?ml$
        pass_filenames: false

      - id: docker-environment-check
        name: "ğŸ³ Docker ç’°å¢ƒãƒã‚§ãƒƒã‚¯"
        entry: bash -c 'docker --version && docker compose version && echo "âœ… Docker ç’°å¢ƒæ­£å¸¸"'
        language: system
        pass_filenames: false
        files: ^(Dockerfile|docker-compose\.ya?ml|\.dockerignore)$

      # é«˜é€Ÿå˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆstandard ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šã§æœ‰åŠ¹ï¼‰
      - id: actions-simulator-unit-tests
        name: "ğŸ§ª Actions Simulator å˜ä½“ãƒ†ã‚¹ãƒˆ"
        entry: >
          uv run pytest
          tests/test_hangup_unit.py::TestDiagnosticServiceUnit::test_diagnostic_service_initialization
          tests/test_hangup_unit.py::TestProcessMonitorUnit::test_process_monitor_initialization
          tests/test_hangup_unit.py::TestExecutionTracerUnit::test_execution_tracer_initialization
          -x --tb=short --disable-warnings --timeout=30
        language: system
        pass_filenames: false
        files: ^(src/|tests/test_hangup_unit\.py)

      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
      - id: actions-simulator-config-check
        name: "âš™ï¸ Actions Simulator è¨­å®šæ¤œè¨¼"
        entry: bash -c 'if [ -f ".env.example" ]; then echo "âœ… .env.example å­˜åœ¨ç¢ºèª"; else echo "âŒ .env.example ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"; exit 1; fi'
        language: system
        files: ^(\.env\.example|pyproject\.toml|main\.py)$
        pass_filenames: false

      # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
      - id: version-consistency-check
        name: "ğŸ·ï¸ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯"
        entry: bash -c 'make version-sync && echo "âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ç¢ºèªå®Œäº†"'
        language: system
        files: ^(pyproject\.toml|main\.py)$
        pass_filenames: false

      # === å³æ ¼ãƒ¬ãƒ™ãƒ«å°‚ç”¨ãƒã‚§ãƒƒã‚¯ ===
      # ä»¥ä¸‹ã¯ CONFIG_LEVEL ãŒ "strict" ã®å ´åˆã®ã¿æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„

      # - id: actions-simulator-integration-tests
      #   name: "ğŸ”— Actions Simulator çµ±åˆãƒ†ã‚¹ãƒˆ"
      #   entry: bash -c 'make test-hangup-quick'
      #   language: system
      #   pass_filenames: false
      #   files: ^(src/|tests/)

      # - id: documentation-link-check
      #   name: "ğŸ”— ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯æ¤œè¨¼"
      #   entry: bash -c 'make check-docs'
      #   language: system
      #   files: \.md$
      #   pass_filenames: false

      # - id: security-scan-quick
      #   name: "ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚­ãƒ£ãƒ³"
      #   entry: bash -c 'make security SKIP_BUILD=true SEVERITY=HIGH'
      #   language: system
      #   files: ^(Dockerfile|requirements.*|pyproject\.toml)$
      #   pass_filenames: false

# === ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰ ===
#
# 1. è¨­å®šãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´:
#    CONFIG_LEVEL ã®å€¤ã‚’ "basic", "standard", "strict" ã®ã„ãšã‚Œã‹ã«å¤‰æ›´
#
# 2. ç‰¹å®šã®ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–:
#    è©²å½“ã™ã‚‹hookã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼ˆ# ã‚’è¡Œé ­ã«è¿½åŠ ï¼‰
#
# 3. é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ :
#    exclude ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ 
#
# 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒã‚§ãƒƒã‚¯è¿½åŠ :
#    local repo ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ–°ã—ã„hookã‚’è¿½åŠ 
#
# 5. GitHub Actions Simulator çµ±åˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º:
#    - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®èª¿æ•´
#    - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã®å¤‰æ›´
#    - è¿½åŠ ã®æ¤œè¨¼ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
#
# === æ®µéšçš„å°å…¥ã®æ¨å¥¨æ‰‹é † ===
#
# 1. æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å°å…¥:
#    a) CONFIG_LEVEL ã‚’ "basic" ã«è¨­å®š
#    b) pre-commit install ã‚’å®Ÿè¡Œ
#    c) pre-commit run --all-files ã§å…¨ä½“ãƒã‚§ãƒƒã‚¯
#    d) å•é¡Œã‚’ä¿®æ­£å¾Œã€"standard" ãƒ¬ãƒ™ãƒ«ã«ç§»è¡Œ
#
# 2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ä½¿ç”¨:
#    a) CONFIG_LEVEL ã‚’ "standard" ã«è¨­å®š
#    b) å¿…è¦ã«å¿œã˜ã¦é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¿æ•´
#    c) ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
#
# 3. CI/CDç’°å¢ƒã§ã®ä½¿ç”¨:
#    a) CONFIG_LEVEL ã‚’ "strict" ã«è¨­å®š
#    b) å…¨ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–
#    c) å¤±æ•—æ™‚ã®é€šçŸ¥è¨­å®šã‚’è¿½åŠ 
#
# === GitHub Actions Simulator ã¨ã®çµ±åˆä¾‹ ===
#
# ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ä»¥ä¸‹ã®çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æä¾›ã—ã¾ã™:
#
# 1. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼äº‹å‰æ¤œè¨¼:
#    - GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
#    - Actions Simulator ã§ã®å®Ÿè¡Œå¯èƒ½æ€§ç¢ºèª
#
# 2. Dockerç’°å¢ƒæ•´åˆæ€§:
#    - Dockerfileå“è³ªãƒã‚§ãƒƒã‚¯
#    - docker-compose.ymlæ§‹æ–‡æ¤œè¨¼
#    - ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒã®åŸºæœ¬å‹•ä½œç¢ºèª
#
# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§:
#    - ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å­˜åœ¨ç¢ºèª
#    - ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®åŒæœŸç¢ºèª
#    - ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
#
# 4. å“è³ªã‚²ãƒ¼ãƒˆçµ±åˆ:
#    - æ®µéšçš„ãªå“è³ªãƒ¬ãƒ™ãƒ«é©ç”¨
#    - é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºã«å¿œã˜ãŸãƒã‚§ãƒƒã‚¯å¼·åº¦èª¿æ•´
#    - CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®é€£æº
#
# === ä½¿ç”¨æ–¹æ³• ===
#
# 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚³ãƒ”ãƒ¼:
#    cp .pre-commit-config.yaml.sample .pre-commit-config.yaml
#
# 2. è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º:
#    ã‚¨ãƒ‡ã‚£ã‚¿ã§ .pre-commit-config.yaml ã‚’ç·¨é›†
#
# 3. pre-commit ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:
#    pre-commit install
#
# 4. åˆå›å®Ÿè¡Œ:
#    pre-commit run --all-files
#
# 5. Make ã‚³ãƒãƒ³ãƒ‰ã§ã®å®Ÿè¡Œ:
#    make pre-commit
#
# === ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ===
#
# å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:
#
# 1. Dockerç’°å¢ƒ: make docker-health
# 2. Pythonç’°å¢ƒ: uv sync
# 3. æ¨©é™è¨­å®š: ./scripts/fix-permissions.sh
# 4. è¨­å®šæ¤œè¨¼: pre-commit validate-config
# 5. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢: pre-commit clean
